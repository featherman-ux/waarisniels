---
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './BaseLayout.astro';
import Comments from '../components/Comments.jsx';
import { ViewCounter } from '../components/ViewCounter.jsx';
import { LikeButton } from '../components/LikeButton.jsx';

export interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
if (!post || !post.data) {
  throw new Error('`post` or `post.data` is missing in BlogPostLayout.astro');
}

const { title, description, pubDate, image, tags } = post.data;
const { Content } = await post.render();

const dateStr = new Date(pubDate).toLocaleDateString('nl-NL', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const currentPath = Astro.url.pathname;
const siteUrl = import.meta.env.SITE;
---
<BaseLayout title={title} description={description ?? title}>
  <article class="max-w-3xl mx-auto">
    {image?.url && (
      <figure class="hero">
        <img
          src={image.url}
          alt={image.alt ?? title}
          loading="eager"
          decoding="async"
          sizes="(max-width: 768px) 100vw, 1024px"
        />
        <div class="hero-grad" />
      </figure>
    )}

    <header class="mb-4">
      <h1>{title}</h1>
      <div>{dateStr}</div>
      {tags?.length && (
        <div class="flex flex-wrap gap-2 mt-2"> {/* Added a wrapper for better spacing */}
          {tags.map((t) => (
            <span class="chip" key={t}>{t}</span>
          ))}
        </div>
      )}

      <div class="meta-row">
        <ViewCounter client:load path={currentPath} apiUrl={siteUrl} />
        <LikeButton client:load likeKey={currentPath} apiUrl={siteUrl} />
      </div>

      {description && <p class="mt-2 text-lg text-subtle">{description}</p>} {/* Example of using utility text */}
    </header>

    <section class="prose-wrap">
      <Content />
    </section>

    <footer>
      <Comments client:load slug={post.slug} apiUrl={siteUrl} />
    </footer>
  </article>
</BaseLayout>