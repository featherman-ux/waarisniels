---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogPostPreview from '../../components/BlogPostPreview.astro';

export const prerender = true;

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('blog', ({ data }) =>
    import.meta.env.PROD ? data.draft !== true : true
  );

  const sortedPosts = allPosts.sort(
    (a, b) =>
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
  );

  return paginate(sortedPosts, {
    params: { page: undefined },
    pageSize: 10,
  });
}

const { page } = Astro.props;
const posts = page?.data ?? [];
---
<BaseLayout title="My Travel Blog" description="All my adventures in one place.">
  <h1>My Travel Blog</h1>
  <p>Follow my journey around the world, one post at a time.</p>
  <div class="post-list">
    {posts.map((p) => <BlogPostPreview post={p} />)}
  </div>

  <div class="pagination">
    {page?.url?.prev && <a href={page.url.prev}>&larr; Previous</a>}
    {page?.url?.next && <a href={page.url.next}>Next &rarr;</a>}
  </div>
</BaseLayout>
