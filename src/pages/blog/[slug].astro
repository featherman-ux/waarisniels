---
import { getCollection } from 'astro:content';
import BlogPostLayout from '../../layouts/BlogPostLayout.astro';

// Since we're using output: 'server', we don't need getStaticPaths
// The page will be rendered on-demand for each request

// Grab the slug from URL params and fetch the matching post
const { slug } = Astro.params;

if (!slug) {
  return new Response(null, {
    status: 400,
    statusText: 'Slug parameter is required',
  });
}

const posts = await getCollection('blog', ({ data }) =>
  import.meta.env.PROD ? !data.draft : true
);

const post = posts.find((p) => p.slug === slug);

if (!post) {
  return new Response(null, {
    status: 404,
    statusText: `Blog post not found: ${slug}`,
  });
}
---

<BlogPostLayout post={post} />
