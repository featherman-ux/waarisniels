---
import { getCollection } from 'astro:content';
import BlogPostLayout from '../../layouts/BlogPostLayout.astro';

// 1) Generate all slugs for pre-rendering
export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) =>
    import.meta.env.PROD ? !data.draft : true
  );
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

// 2) In-page, grab the slug and fetch the matching post
const { slug } = Astro.params;
const posts = await getCollection('blog');
const post = posts.find((p) => p.slug === slug);

if (!post) {
  // 3) If no post matches, return a 404
  throw Astro.error({
    status: 404,
    statusText: `Blog post not found: ${slug}`,
  });
}
---
<BlogPostLayout post={post} />
