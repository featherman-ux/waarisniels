---
import BaseLayout from '../layouts/BaseLayout.astro';
import '../styles/home.css';
import { getCollection } from 'astro:content';
import BlogPostPreview from '../components/BlogPostPreview.astro';
import HomePopup from '../components/HomePopup.astro';
import { VibeWidget } from '../components/VibeWidget.jsx';

const latestPosts = (
  await getCollection('blog', ({ data }) => import.meta.env.PROD ? !data.draft : true)
)
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate))
  .slice(0, 3);
---

<BaseLayout title="Waar is Niels?" description="Welkom op mijn reisblog">
  <!-- Floating Vibe Widget -->
  <VibeWidget client:load />

  <!-- Hero with your specified image -->
  <section class="hero">
    <img
      src="/images/homepage.jpeg"
      alt="Nieuwe hero-afbeelding voor de homepage"
    />
    <div class="hero-text">
      <div>
        <h1>Waar is Niels?</h1>
        <p>Voor het eind van deze week weer updates!</p>
      </div>
    </div>
  </section>

  <!-- Popup -->
  <HomePopup />

  <!-- Map link -->
  <div class="map-link">
    <a href="/map">
      🗺️ Bekijk de kaart met mijn reisroute
    </a>
  </div>

  <!-- Latest blog posts -->
  <section class="posts">
    <h2>Laatste blogposts</h2>
    {latestPosts.length > 0 ? (
      <div class="grid-posts">
        {latestPosts.map(post => (<BlogPostPreview post={post} />))}
      </div>
    ) : (
      <p style="text-align:center;">Nog geen blogposts beschikbaar.</p>
    )}
  </section>

</BaseLayout>
